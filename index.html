<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∂ú‡∂´‡∑í‡∂≠ ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ‡∑Å‡∂ª‡∑ì‡∂ª‡∂∫ (body) ‡∑É‡∑Ñ ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± container ‡∂ë‡∂ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂Ö‡∂∏‡∂≠‡∂ª CSS */
        body {
            font-family: 'Inter', sans-serif;
            background: #eef2ff;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* ‡∂∏‡∑ú‡∂©‡∂Ω‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑ì ‡∑Ä‡∂± ‡∑Ä‡∑í‡∂ß ‡∂¥‡∑É‡∑î‡∂∂‡∑í‡∂∏‡∑ä ‡∂ö‡∑è‡∂©‡∑ä‡∂¥‡∂≠ ‡∂Ö‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ */
        .is-modal-active .main-card {
            pointer-events: none;
            opacity: 0.5;
            transform: scale(0.95);
        }

        /* ‡∑É‡∂¢‡∑ì‡∑Ä‡∑í‡∂ö‡∂ª‡∂´ (Animations) */
        @keyframes correct-pop {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        @keyframes incorrect-shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-5px) rotate(-1deg); }
            40% { transform: translateX(5px) rotate(1deg); }
            60% { transform: translateX(-5px) rotate(-1deg); }
            80% { transform: translateX(5px) rotate(1deg); }
            100% { transform: translateX(0); }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ‡∂∂‡∑î‡∂∂‡∑î‡∑Ö‡∑î ‡∑É‡∂¢‡∑ì‡∑Ä‡∑í‡∂ö‡∂ª‡∂´‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è CSS */
        .bubble-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            will-change: transform, background-color;
            box-shadow: 0 0 20px 10px rgba(100, 116, 139, 0.5);
        }

        /* ‡∂∂‡∑î‡∂∂‡∑î‡∑Ö‡∑î ‡∑Ä‡∂ª‡∑ä‡∂´ ‡∑É‡∂¢‡∑ì‡∑Ä‡∑í‡∂ö‡∂ª‡∂´‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è */
        @keyframes bubble-color-morph {
            0%, 100% { background-color: #a78bfa; }
            25% { background-color: #60a5fa; }
            50% { background-color: #34d399; }
            75% { background-color: #fcd34d; }
        }

        .bubble {
            animation: bubble-color-morph 20s infinite alternate ease-in-out;
            animation-delay: calc(var(--delay) * -1s);
        }

        /* ‡∑Ä‡∑í‡∂±‡∑í‡∑Ä‡∑í‡∂Ø ‡∂∫‡∂± ‡∂¥‡∑É‡∑î‡∂∂‡∑í‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* ‡∂∏‡∂∞‡∑ä‚Äç‡∂∫‡∂ú‡∂≠ ‡∂∂‡∑ú‡∂≠‡∑ä‡∂≠‡∂∏‡∑ä ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂¥‡∂±‡∑ä‡∂≠‡∑í‡∂∫ */
        .btn-game {
            @apply flex-1 py-3 sm:py-4 rounded-full font-bold text-white shadow-lg transition-all duration-300 transform hover:scale-105;
        }

        /* ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä ‡∑É‡∂≥‡∑Ñ‡∑è CSS */
        h1, h2 {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <div class="bubble-container" id="bubble-container"></div>
    <div id="app-container" class="min-h-screen flex items-center justify-center p-4 sm:p-8 relative z-10">
        <div class="w-full max-w-2xl main-card rounded-3xl shadow-2xl p-6 sm:p-10 relative overflow-hidden">
            <nav class="flex justify-center space-x-4 mb-8">
                <button id="nav-home" class="text-gray-600 font-semibold px-4 py-2 rounded-lg hover:bg-white hover:shadow transition-colors">‡∂∏‡∑î‡∂Ω‡∑ä ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä</button>
                <button id="nav-game" class="text-gray-600 font-semibold px-4 py-2 rounded-lg hover:bg-white hover:shadow transition-colors">‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä</button>
                <button id="nav-scoreboard" class="text-gray-600 font-semibold px-4 py-2 rounded-lg hover:bg-white hover:shadow transition-colors">‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂¥‡∑î‡∑Ä‡∂ª‡∑î‡∑Ä</button>
            </nav>
            <div id="content" class="fade-in-up"></div>
        </div>
    </div>

    <div id="game-modal-container" class="fixed inset-0 hidden items-center justify-center z-50 modal-overlay p-4 sm:p-8">
        <div id="game-modal-content" class="w-full max-w-xl p-6 sm:p-10 rounded-3xl shadow-2xl relative transform transition-transform duration-500 scale-95 opacity-0" style="background-color: rgba(191, 219, 254, 0.4); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);"></div>
    </div>

    <script>
        // ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä‡∑ö ‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂± ‡∂ú‡∑ù‡∂Ω‡∑ì‡∂∫ ‡∑Ä‡∑í‡∂†‡∂Ω‡∑ä‚Äç‡∂∫‡∂∫‡∂±‡∑ä
        let currentPage = 'home';
        let finalScore = 0;
        let score = 0;
        let problemsPlayed = 0;
        const totalProblems = 5; // Note: This is set to 5 for a shorter game, you can adjust it.
        let currentProblem = null;
        let expressionItems = [];
        let history = [];
        let resultMessage = '';
        let isCorrect = null;

        // ‡∂ú‡∑ê‡∂ß‡∑Ö‡∑î ‡∂Ø‡∂≠‡∑ä‡∂≠
        const problems = [
            { target: 10, items: [8, 2, "+", 5, 3] },
            { target: 12, items: [5, 7, "+", 6, 2, "√ó"] },
            { target: 20, items: [4, 5, "√ó", 10, 2, "+"] },
            { target: 8, items: [16, 2, "√∑", 4, 2, "-"] },
            { target: 15, items: [18, 3, "-", 10, 5, "√∑"] },
            { target: 6, items: [12, 2, "√∑", 3, 3, "+"] },
            { target: 25, items: [5, 5, "√ó", 20, 5, "-"] },
            { target: 9, items: [1, 8, "+", 10, 1, "-"] },
            { target: 100, items: [10, 10, "√ó", 5, 2, "√ó"] },
            { target: 3, items: [9, 3, "√∑", 6, 2, "√∑"] },
            { target: 7, items: [15, 8, "-", 10, 3, "-"] },
            { target: 18, items: [9, 9, "+", 20, 2, "-"] },
            { target: 30, items: [6, 5, "√ó", 25, 5, "+"] },
            { target: 2, items: [10, 8, "-", 5, 3, "√ó"] },
            { target: 7, items: [10, 9, 8, 2, "-", "-", 4, 3, "√ó"] }
        ];

        // ‡∂Ø‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂±‡∑Ä ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫
        const showAd = (type) => {
            // You can adjust the ad frequency here. For example, to show ads every 3 problems, use problemsPlayed % 3 === 0.
            // For a rewarded ad at the end of each level, you'd call this function differently.
            const adCount = problemsPlayed % 3; // Show an ad every 3 problems
            if (typeof Android !== 'undefined' && Android !== null) {
                try {
                    switch(type) {
                        case 'interstitial':
                            // Assuming you have multiple interstitial ad units configured in Android
                            if (adCount === 0) {
                                Android.showInterstitialAd_1();
                            } else if (adCount === 1) {
                                Android.showInterstitialAd_2();
                            } else {
                                Android.showInterstitialAd_3();
                            }
                            break;
                        case 'rewarded':
                            // Assuming you have multiple rewarded ad units configured in Android
                            if (adCount === 0) {
                                Android.showRewardedAd_1();
                            } else if (adCount === 1) {
                                Android.showRewardedAd_2();
                            } else {
                                Android.showRewardedAd_3();
                            }
                            break;
                    }
                    console.log(`Android JavaScript Interface ‡∑Ä‡∑ô‡∂≠ ${type} ad ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß ‡∑É‡∂Ç‡∂•‡∑è‡∑Ä ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∫.`);
                } catch (error) {
                    console.error(`${type} ad ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫:`, error);
                }
            } else {
                console.warn("Android JavaScript Interface ‡∂ë‡∂ö ‡∑Ñ‡∂≥‡∑î‡∂±‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö. ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫ ‡∂∂‡∑ä‚Äç‡∂ª‡∑Ä‡∑î‡∑É‡∂ª‡∂∫‡∂ö ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂±‡∑ê‡∂≠.");
            }
        };

        // ‡∂Ö‡∑Ñ‡∂π‡∑î ‡∂∂‡∑î‡∂∂‡∑î‡∑Ö‡∑î ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫
        const generateBubbles = () => {
            const container = document.getElementById('bubble-container');
            const bubbleSizes = [32, 40, 48, 56, 64];

            for (let i = 0; i < 10; i++) {
                const bubble = document.createElement('div');
                const size = bubbleSizes[Math.floor(Math.random() * bubbleSizes.length)];
                const xPos = Math.random() * 100;
                const yPos = Math.random() * 100;
                const animDelay = Math.random() * 10;
                bubble.className = `bubble w-${size} h-${size}`;
                bubble.style.top = `${yPos}vh`;
                bubble.style.left = `${xPos}vw`;
                bubble.style.setProperty('--delay', animDelay);
                container.appendChild(bubble);
            }
        };

        // ‡∂¥‡∑í‡∂ß‡∑î ‡∂Ö‡∂≠‡∂ª ‡∑É‡∂Ç‡∂†‡∑è‡∂Ω‡∂±‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫‡∂ö‡∑í.
        const navigate = (page, finalScoreValue = 0) => {
            currentPage = page;
            if (page === 'scoreboard') {
                finalScore = finalScoreValue;
            }
            renderPage();
            updateNavButtons();
        };

        // ‡∑É‡∂Ç‡∂†‡∑è‡∂Ω‡∂± ‡∂∂‡∑ú‡∂≠‡∑ä‡∂≠‡∂∏‡∑ä ‡∑Ä‡∂Ω ‡∂¥‡∑ô‡∂±‡∑î‡∂∏ ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
        const updateNavButtons = () => {
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-white', 'text-purple-600', 'shadow');
                btn.classList.add('text-gray-600');
            });
            const activeBtn = document.getElementById(`nav-${currentPage}`);
            if (activeBtn) {
                activeBtn.classList.remove('text-gray-600');
                activeBtn.classList.add('bg-white', 'text-purple-600', 'shadow');
            }
        };

        // ‡∂ú‡∂´‡∑í‡∂≠ ‡∂¥‡∑ä‚Äç‡∂ª‡∂ö‡∑è‡∑Å‡∂±‡∂∫‡∂ö‡∑ä ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑í‡∂≠‡∑Ä ‡∂á‡∂ú‡∂∫‡∑ì‡∂∏‡∑ö ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫‡∂ö‡∑í.
        const evaluateExpression = (expression) => {
            try {
                const sanitizedExpression = expression.replace(/[^0-9+\-*/().]/g, '');
                const evalExpression = sanitizedExpression.replace(/√∑/g, '/').replace(/√ó/g, '*');
                const safeEvaluator = new Function(`return (${evalExpression});`);
                return safeEvaluator();
            } catch (e) {
                return NaN;
            }
        };

        // array ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∏‡∑è‡∂ª‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂ã‡∂¥‡∂ö‡∑è‡∂ª‡∑ì ‡∑Ä‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫‡∂ö‡∑í.
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        // ‡∂±‡∑Ä ‡∂ú‡∑ê‡∂ß‡∑Ö‡∑î‡∑Ä‡∂ö‡∑ä ‡∂ã‡∂≠‡∑ä‡∂¥‡∑è‡∂Ø‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫‡∂ö‡∑í.
        const generateNewGame = () => {
            if (problemsPlayed >= totalProblems) {
                handleGameEnd(score);
                return;
            }
            const shuffledProblems = shuffleArray([...problems]);
            currentProblem = shuffledProblems[Math.floor(Math.random() * shuffledProblems.length)];
            expressionItems = shuffleArray([...currentProblem.items]);
            history = [];
            resultMessage = '';
            isCorrect = null;
            renderGameModal();
        };

        // ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä ‡∑Ä‡∑ñ ‡∑Ä‡∑í‡∂ß ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑Ä‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫
        const handleGameEnd = (finalScoreValue) => {
            const modalContainer = document.getElementById('game-modal-container');
            const modalContent = document.getElementById('game-modal-content');

            document.body.classList.remove('is-modal-active');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');

            setTimeout(() => {
                modalContainer.classList.add('hidden');

                // **Rewarded Ad logic:**
                // If the last answer was correct, offer a rewarded ad to double the score.
                if (isCorrect) {
                    // You can uncomment the line below to trigger the rewarded ad when an answer is correct.
                    // showRewardedAd(); // This will call Android.showRewardedAd_X()
                }

                // **Interstitial Ad logic:**
                // Show an interstitial ad every 'totalProblems' levels completed (adjust frequency as needed).
                if (problemsPlayed > 0 && problemsPlayed % totalProblems === 0) {
                    console.log(`Every ${totalProblems} levels completed. Showing interstitial ad.`);
                    showAd('interstitial');
                }

                // ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä ‡∑Ä‡∑ñ ‡∂¥‡∑É‡∑î ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂¥‡∑î‡∑Ä‡∂ª‡∑î‡∑Ä‡∂ß ‡∂∫‡∂±‡∑ä‡∂±
                navigate('scoreboard', finalScoreValue);
            }, 300);
        };

        // ‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏‡∂∫‡∂ö‡∑ä ‡∂∏‡∂≠ click ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑Ñ‡∑ê‡∑É‡∑í‡∂ª‡∑Ä‡∑ì‡∂∏
        const handleItemClick = (item, clickedIndex) => {
            history.push(item);
            expressionItems = expressionItems.filter((_, i) => i !== clickedIndex);
            renderGameModal();
        };

        // ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂¥‡∑í‡∂∫‡∑Ä‡∂ª ‡∂Ü‡∂¥‡∑É‡∑î ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
        const handleUndo = () => {
            if (history.length > 0) {
                const lastItem = history.pop();
                expressionItems.push(lastItem);
                renderGameModal();
            }
        };

        // ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑è‡∂ú‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂ö‡∑è‡∑Å‡∂±‡∂∫ ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
        const handleCheck = () => {
            const expression = history.join('');
            const result = evaluateExpression(expression);
            const modalContent = document.getElementById('game-modal-content');

            if (result === currentProblem.target) {
                isCorrect = true;
                resultMessage = '‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í! üéâ';
                score += 10; // Points for a correct answer
                modalContent.style.animation = 'correct-pop 1s forwards';
            } else {
                isCorrect = false;
                resultMessage = '‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í. üò•';
                score = Math.max(0, score - 2); // Penalty for incorrect answer
                modalContent.style.animation = 'incorrect-shake 0.5s forwards';
            }

            renderGameModal();

            setTimeout(() => {
                modalContent.style.animation = '';
                problemsPlayed++;

                if (problemsPlayed >= totalProblems) {
                    handleGameEnd(score);
                } else {
                    // ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä ‡∂±‡∑ê‡∂≠‡∑ä‡∂±‡∂∏‡∑ä, ‡∂ä‡∑Ö‡∂ü ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ß ‡∂∫‡∂±‡∑ä‡∂±
                    generateNewGame();
                }
            }, 1000);
        };

        // Rewarded Ad ‡∂ë‡∂ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ (This function is called from the UI when the user opts to watch an ad)
        const showRewardedAd = () => {
            // This function is designed to be called when a user wants to watch a rewarded ad.
            // The logic for *when* to show it (e.g., after a correct answer) is in handleGameEnd.
            showAd('rewarded');
        }

        // Home Page ‡∂ë‡∂ö‡∑ö HTML ‡∂ö‡∑ö‡∂≠‡∂∫
        const renderHomePage = () => {
            return `
                <div class="text-center p-4">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-800 mb-4 animate-[fade-in-up_1s_ease-in-out]">‡∂ú‡∂´‡∑í‡∂≠ ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä‡∂ß ‡∑É‡∑è‡∂Ø‡∂ª‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∂±‡∑í‡∂∏‡∑î</h1>
                    <p class="text-sm sm:text-lg text-gray-700 mb-8 animate-[fade-in-up_1s_ease-in-out_0.2s_forwards] opacity-0">
                      ‡∂î‡∂∂‡∂ß ‡∂Ø‡∑î‡∂±‡∑ä ‡∂Ö‡∂Ç‡∂ö ‡∑É‡∑Ñ ‡∂ú‡∂´‡∑í‡∂≠ ‡∂ö‡∂ª‡∑ä‡∂∏ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∂∫‡∑ô‡∂±‡∑ä ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∂ö‡∑è‡∑Å‡∂±‡∂∫‡∂ö‡∑ä ‡∑É‡∑è‡∂Ø‡∑è ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂ú‡∂≠ ‡∂Ö‡∂ú‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂≠ ‡∑Ñ‡∑ê‡∂ö‡∑í‡∂Ø‡∑ê‡∂∫‡∑í ‡∂∂‡∂Ω‡∂∏‡∑î.
                    </p>
                    <button id="start-game-btn" class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white text-base sm:text-xl font-bold py-3 px-8 rounded-full shadow-lg hover:from-purple-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 animate-[pulse_2s_infinite]">
                      ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </button>
                </div>
            `;
        };

        // Game Page ‡∂ë‡∂ö‡∑ö HTML ‡∂ö‡∑ö‡∂≠‡∂∫
        const renderGamePage = () => {
            return `
                <div class="text-center p-4 fade-in-up">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6">‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä</h2>
                    <p class="text-sm sm:text-base text-gray-600 mb-8">‡∂î‡∂∂‡∂ß ‡∂ö‡∑ê‡∂∏‡∂≠‡∑í ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∑è ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö.</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        ${[1, 2, 3, 4, 5, 6].map(level => `
                            <button class="start-math-btn bg-blue-500 text-white text-lg sm:text-xl font-bold py-4 rounded-xl shadow-lg hover:bg-blue-600 transform hover:scale-105 transition-transform duration-300">
                                ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏ ${level}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        // Scoreboard Page ‡∂ë‡∂ö‡∑ö HTML ‡∂ö‡∑ö‡∂≠‡∂∫
        const renderScoreboardPage = () => {
            return `
                <div class="text-center p-4 fade-in-up">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6">‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂¥‡∑î‡∑Ä‡∂ª‡∑î‡∑Ä</h2>
                    <p class="text-lg sm:text-xl text-gray-600 mb-4">‡∂î‡∂∂‡∂ú‡∑ö ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä ‡∂Ω‡∂ö‡∑î‡∂´‡∑î:</p>
                    <div class="text-4xl sm:text-6xl font-extrabold text-blue-600 mb-8 animate-[pulse_1s_ease-in-out]">${finalScore}</div>
                    <button id="play-again-btn" class="bg-purple-500 text-white text-base sm:text-lg font-bold py-3 px-8 rounded-full shadow-lg hover:bg-purple-600 transform hover:scale-105 transition-transform duration-300">
                        ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </button>
                </div>
            `;
        };

        // Modal ‡∂ë‡∂ö‡∑ö ‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂ú‡∂≠‡∂∫ render ‡∂ö‡∂ª‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫‡∂ö‡∑í.
        const renderGameModal = () => {
            const modalContainer = document.getElementById('game-modal-container');
            const modalContent = document.getElementById('game-modal-content');
            const expressionItemButtons = expressionItems.map((item, index) => `
                <button
                    class="bg-white text-blue-800 text-xl sm:text-2xl font-bold rounded-xl shadow-md hover:bg-gray-100 transition-colors pop-in w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center"
                    onclick="handleItemClick('${item}', ${index})"
                >
                    ${item}
                </button>
            `).join('');
            const historySpans = history.map((item) => `
                <span class="bg-white text-purple-600 text-lg sm:text-xl font-bold px-3 py-1 sm:px-4 sm:py-2 rounded-lg shadow-md pop-in">
                    ${item}
                </span>
            `).join('');
            const resultMessageClass = `text-center font-bold text-md sm:text-xl mt-4 ${isCorrect ? 'text-green-600' : 'text-red-600'} pop-in`;

            modalContent.innerHTML = `
                <button
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"
                    onclick="handleGameEnd(score)"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h2 class="text-2xl sm:text-3xl font-extrabold text-blue-800 mb-2 text-center">‡∂ú‡∂´‡∑í‡∂≠ ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫</h2>
                <p class="text-sm sm:text-lg font-bold text-gray-700 mb-4 text-center">‡∂Ω‡∂ö‡∑î‡∂´‡∑î: ${score}</p>
                <div class="flex flex-col items-center p-4 bg-gray-100 rounded-2xl mb-6 shadow-inner w-full">
                    <p class="text-lg sm:text-xl font-semibold text-gray-800 text-center">
                        ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö‡∂∫: <span class="text-2xl sm:text-3xl font-extrabold text-purple-600">${currentProblem.target}</span>
                    </p>
                </div>
                <div class="w-full flex flex-wrap justify-center gap-2 sm:gap-4 p-4 bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl mb-6">
                    ${expressionItemButtons}
                </div>
                <div class="w-full h-20 sm:h-24 bg-gray-200 border-2 border-gray-300 rounded-lg flex flex-wrap justify-center items-center gap-2 p-2 mb-6">
                    ${historySpans}
                </div>
                <div class="flex justify-between w-full gap-4">
                    <button class="btn-game bg-gray-500 hover:bg-gray-600" onclick="handleUndo()" ${history.length === 0 ? 'disabled' : ''}>
                        ‡∂Ü‡∂¥‡∑É‡∑î ‡∂ú‡∂±‡∑ä‡∂±
                    </button>
                    <button class="btn-game bg-green-500 hover:bg-green-600" onclick="handleCheck()">
                        ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </button>
                </div>
                ${resultMessage ? `<p class="${resultMessageClass}">${resultMessage}</p>` : ''}

                ${isCorrect ? `
                    <div class="mt-6 text-center">
                        <p class="text-base sm:text-lg font-bold text-gray-700 mb-2">‡∂î‡∂∂‡∑ö ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂Ø‡∑ô‡∂ú‡∑î‡∂´ ‡∂ö‡∂ª ‡∂ú‡∂±‡∑ä‡∂±!</p>
                        <button class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-300" onclick="showRewardedAd()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.173l-4.24-4.24a1 1 0 00-1.414 1.414L13.338 12l-4.24 4.24a1 1 0 001.414 1.414l4.24-4.24a1 1 0 000-1.414z" />
                            </svg>
                            ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä‡∂ö‡∑ä ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±
                        </button>
                    </div>
                ` : ''}
            `;

            // ‡∂∏‡∑ú‡∂©‡∂Ω‡∑ä ‡∂ë‡∂ö ‡∂Ø‡∂ª‡∑ä‡∑Å‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∑Ñ ‡∑É‡∂¢‡∑ì‡∑Ä‡∑í‡∂ö‡∂ª‡∂´‡∂∫ (animation) ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
            document.body.classList.add('is-modal-active');
            modalContainer.classList.remove('hidden');
            setTimeout(() => {
                modalContainer.classList.add('flex');
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        };

        // ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä render ‡∂ö‡∂ª‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫
        const renderPage = () => {
            const contentDiv = document.getElementById('content');
            contentDiv.classList.add('opacity-0');
            setTimeout(() => {
                switch(currentPage) {
                    case 'home':
                        contentDiv.innerHTML = renderHomePage();
                        document.getElementById('start-game-btn').addEventListener('click', () => navigate('game'));
                        break;
                    case 'game':
                        contentDiv.innerHTML = renderGamePage();
                        document.querySelectorAll('.start-math-btn').forEach(btn => {
                            btn.addEventListener('click', () => {
                                score = 0;
                                problemsPlayed = 0;
                                generateNewGame();
                            });
                        });
                        break;
                    case 'scoreboard':
                        contentDiv.innerHTML = renderScoreboardPage();
                        document.getElementById('play-again-btn').addEventListener('click', () => navigate('game'));
                        break;
                }
                contentDiv.classList.remove('opacity-0');
            }, 300);
        };

        // ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂Ö‡∂©‡∑Ä‡∑í‡∂∫ load ‡∑Ä‡∑ñ ‡∑Ä‡∑í‡∂ß ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂± ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫
        window.onload = function() {
            generateBubbles();
            document.getElementById('nav-home').addEventListener('click', () => navigate('home'));
            document.getElementById('nav-game').addEventListener('click', () => navigate('game'));
            document.getElementById('nav-scoreboard').addEventListener('click', () => navigate('scoreboard'));
            navigate('home');
        };
    </script>
</body>
</html>
