<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>‡∂ú‡∂´‡∑í‡∂≠ Drag & Drop ‡∂ö‡∑î‡∂©‡∑î‡∂ö‡∑ä‡∂ö‡∑è</title>
    <style>
        /* CSS Variables for a clean, animated theme */
        :root {
            --bg: #dbe9f4; /* soft pastel blue */
            --card: #ffffff;
            --accent: #4f86c6; /* calm blue */
            --accent-2: #6ab7ff; /* light blue */
            --ok: #22a06b; /* green */
            --bad: #d64545; /* red */
            --text: #0f172a; /* slate-900 */
        }
        
        /* Basic styles, removing default margins/paddings and using a modern font stack */
        *{box-sizing:border-box}
        body {
            margin: 0; 
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Sinhala Sangam MN", "Iskoola Pota", sans-serif;
            background: radial-gradient(1200px 600px at 10% -10%, #eef6ff 0, transparent 60%),
                        radial-gradient(900px 500px at 110% 10%, #eaf4ff 0, transparent 60%), var(--bg);
            color: var(--text);
            min-height: 100dvh;
            display: grid; 
            place-items: center; 
            padding: 24px;
        }

        /* Main app container */
        .app {
            width: min(1100px, 100%); 
            max-width: 1100px;
            display: grid; 
            gap: 18px;
        }

        /* Header section with score and controls */
        header {
            display: grid; 
            gap: 10px; 
            padding: 16px 18px; 
            border-radius: 16px; 
            background: var(--card);
            box-shadow: 0 6px 20px rgba(10,60,120,.08);
        }
        h1 { margin: 0; font-size: clamp(20px, 2.8vw, 28px) }
        .meta { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: space-between }
        .score {
            font-weight: 700; padding: 8px 12px; border-radius: 999px; 
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: white; letter-spacing: .2px; 
            box-shadow: 0 4px 12px rgba(79,134,198,.35);
        }

        /* Progress bar */
        .bar { height: 10px; width: 100%; background: #e6eef6; border-radius: 999px; overflow: hidden; }
        .bar > div { height: 100%; width: 0; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width .35s ease; }
        
        /* Buttons */
        .controls { display: flex; gap: 10px; flex-wrap: wrap }
        button {
            appearance: none; border: none; cursor: pointer; font-weight: 600; letter-spacing: .2px;
            padding: 10px 14px; background: var(--text); color: white; border-radius: 12px;
            box-shadow: 0 6px 16px rgba(15,23,42,.2); 
            transition: transform .15s ease, box-shadow .2s ease;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(15,23,42,.25); }
        button:active { transform: translateY(0); box-shadow: 0 6px 16px rgba(15,23,42,.2); }
        button.secondary { background: #1e293b }
        
        /* Quiz grid */
        .grid {
            display: grid; 
            gap: 16px; 
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        }

        /* Question card */
        .card {
            background: var(--card); 
            border-radius: 18px; 
            padding: 16px; 
            display: grid; 
            gap: 12px;
            box-shadow: 0 6px 20px rgba(10,60,120,.08);
            position: relative;
        }
        .q-title { font-weight: 700; font-size: 18px; }

        /* Drop zone */
        .dropzone {
            display: grid; 
            place-items: center; 
            border: 2px dashed #b4c9e9; 
            border-radius: 14px; 
            padding: 16px; 
            min-height: 64px;
            transition: all .2s ease;
            background: linear-gradient(0deg, #f6fbff 0, #fff 100%);
            position: relative;
        }
        /* Drop zone animations and states */
        .dropzone.hover { border-color: var(--accent); background: #f0f7ff; transform: scale(1.01); }
        .dropzone.correct { border-color: var(--ok); background: #ecfbf4; transform: scale(1.02); }
        .dropzone.wrong { border-color: var(--bad); background: #ffefef; animation: shake .5s; }

        /* The answers sidebar container */
        .answers-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 250px;
            max-width: 90%;
            background: linear-gradient(180deg, #fff 0, #f7fbff 100%); 
            border-left: 1px solid #e2eefc;
            box-shadow: -6px 0 20px rgba(10,60,120,.08);
            padding: 24px;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transform: translateX(0);
            transition: transform .3s ease-in-out;
        }
        .answers-sidebar.hidden {
            transform: translateX(100%);
        }
        .answers-sidebar h3 { margin-top: 0; }
        
        /* The answers bank inside the sidebar - NOW VERTICAL */
        .answers-sidebar .bank {
            border: 1px solid #e2eefc;
            box-shadow: none;
            flex-grow: 1;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* The new sidebar toggle button */
        .sidebar-toggle {
            position: absolute;
            top: 50%;
            left: -24px; /* Positioned outside the sidebar */
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            background: var(--card);
            border-radius: 50%;
            display: grid;
            place-items: center;
            box-shadow: -2px 0 8px rgba(10,60,120,.08);
            z-index: 1001;
            border: 1px solid #e2eefc;
        }
        .sidebar-toggle svg {
            transition: transform .3s ease;
        }
        .answers-sidebar.hidden .sidebar-toggle svg {
            transform: rotate(180deg);
        }

        /* Adjust main app padding for larger screens to avoid content being hidden by the sidebar */
        @media (min-width: 900px) {
            .app { padding-right: 270px; }
        }

        /* Draggable answer tiles */
        .tile {
            user-select: none; 
            -webkit-user-drag: element; 
            -webkit-user-select: none;
            padding: 10px 14px; 
            border-radius: 12px; 
            background: white; 
            border: 1.5px solid #c9dbf3;
            box-shadow: 0 4px 10px rgba(10,60,120,.08);
            font-weight: 700; 
            cursor: grab; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            min-width: 56px;
            transition: transform .15s ease, box-shadow .15s ease, opacity .2s ease;
        }
        /* Tile animation on drag */
        .tile:active { cursor: grabbing; transform: scale(1.05); box-shadow: 0 6px 12px rgba(10,60,120,.15); }
        .tile.dragging { opacity: 0; transform: scale(0.8); }
        .tile.lock { opacity: .55; cursor: not-allowed; }
        .tile.selected { outline: 3px solid rgba(79,134,198,.25); }

        /* Result messages */
        .result { font-weight: 700; animation: fadeIn .5s; }
        .result.ok { color: var(--ok); }
        .result.bad { color: var(--bad); }

        /* Footer */
        footer {
            text-align: center; 
            font-size: 14px; 
            color: #334155; 
            opacity: .9;
        }

        /* Toast message for quick feedback */
        .toast {
            position: fixed; 
            inset: auto 16px 16px auto; 
            background: var(--text); 
            color: #fff; 
            padding: 10px 14px; 
            border-radius: 12px; 
            box-shadow: 0 10px 24px rgba(15,23,42,.35);
            transform: translateY(12px); 
            opacity: 0; 
            pointer-events: none; 
            transition: all .25s ease;
        }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* Icon styling (for correct/incorrect marks) */
        .icon {
            font-size: 1.5em; 
            margin-right: 8px; 
            display: inline-block;
            animation: popIn .3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .icon.ok { color: var(--ok); }
        .icon.bad { color: var(--bad); }

        /* Animation keyframes */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Small helper for accessibility */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0 }
    </style>
</head>
<body>
    <div class="app" id="app">
        <header>
            <h1>üß† ‡∂ú‡∂´‡∑í‡∂≠ Drag & Drop ‚Äî ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 5‡∂ö‡∑ä</h1>
            <div class="meta">
                <div class="score" id="score">‡∂Ω‡∂ö‡∑î‡∂´‡∑î: 0 / 5</div>
                <div class="controls">
                    <button id="btnCheck">‡∂¥‡∂ª‡∑í‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
                    <button id="btnReset" class="secondary">‡∂±‡∑Ä ‡∂ú‡∑ö‡∂∏‡∑ä</button>
                </div>
            </div>
            <div class="bar" aria-label="‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í ‡∂¥‡∂ß‡∑í‡∂∫"><div id="progress"></div></div>
        </header>

        <section class="grid" id="quiz"></section>
        
        <footer>
            <p id="finalMsg">‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂Ö‡∂ú‡∂∫ ‡∂ú‡∑ô‡∂±‡∑ä‡∑Ä‡∑è ‡∂á‡∂Ø ‡∂ë‡∑Ä‡∂±‡∑ä‡∂±.</p>
        </footer>
    </div>

    <!-- Answers bank as a fixed sidebar -->
    <div class="answers-sidebar" id="answersSidebar">
        <h3>‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä</h3>
        <div class="bank" id="answersBank" aria-label="‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä"></div>
        <button id="sidebarToggle" class="sidebar-toggle" aria-label="‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä ‡∑É‡∑ê‡∂ü‡∑Ä‡∑ì‡∂∏/‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <template id="cardTpl">
        <article class="card" data-qid="">
            <div class="q-title"></div>
            <div class="dropzone" tabindex="0" role="button" aria-label="‡∂∏‡∑ô‡∂≠‡∑ê‡∂±‡∂ß ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª ‡∂Ø‡∑è‡∂±‡∑ä‡∂±"></div>
            <div class="result" aria-live="polite"></div>
        </article>
    </template>

    <script>
        // Game data: questions and their correct answers
        const DATA = [
            { id: 1, q: "7 + 8 = ?", correct: "15" },
            { id: 2, q: "6 √ó 7 = ?", correct: "42" },
            { id: 3, q: "9 ‚àí 4 = ?", correct: "5" },
            { id: 4, q: "5¬≤ = ?", correct: "25" },
            { id: 5, q: "24 ‡∑Ñ‡∑í ‡∂Ö‡∂ª‡∑ä‡∂∞‡∂∫ = ?", correct: "12" },
        ];

        // Helper functions for selecting DOM elements
        const $ = (sel,el=document) => el.querySelector(sel);
        const $$ = (sel,el=document) => [...el.querySelectorAll(sel)];

        // Get main game elements
        const quiz = $('#quiz');
        const scoreEl = $('#score');
        const progressEl = $('#progress');
        const finalMsg = $('#finalMsg');
        const toast = $('#toast');
        const answersBank = $('#answersBank');
        const sidebarToggle = $('#sidebarToggle');
        const answersSidebar = $('#answersSidebar');

        // Game state variables
        let state = { answered:0, correct:0 };
        let selectedTile = null; // for click-to-place functionality
        let isBankVisible = true;

        // Function to shuffle an array
        function shuffle(arr){
            const a = [...arr];
            for(let i=a.length-1;i>0;i--){
                const j = Math.floor(Math.random()*(i+1));
                [a[i],a[j]]=[a[j],a[i]];
            }
            return a;
        }

        // Creates a new draggable tile element
        function makeTile(text){
            const t = document.createElement('div');
            t.className = 'tile';
            t.textContent = text;
            t.setAttribute('draggable','true');
            t.dataset.value = text;
            t.tabIndex = 0;

            // Drag and drop event listeners
            t.addEventListener('dragstart', (e)=>{
                e.dataTransfer.setData('text/plain', text);
                setTimeout(()=>t.classList.add('dragging'), 0); // Hide the original element slightly after drag starts
            });
            t.addEventListener('dragend', ()=> t.classList.remove('dragging'));

            // Click-to-select functionality
            t.addEventListener('click', (e)=>{
                if(t.classList.contains('lock')) return;
                if(selectedTile) selectedTile.classList.remove('selected');
                selectedTile = t;
                t.classList.add('selected');
                announce(`‡∂≠‡∑ù‡∂ª‡∑è‡∂ú‡∂≠‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª ${text}`);
            });

            return t;
        }

        // Creates a new question card element
        function makeCard(item){
            const tpl = $('#cardTpl').content.firstElementChild.cloneNode(true);
            tpl.dataset.qid = item.id;
            $('.q-title', tpl).textContent = item.q;
            const drop = $('.dropzone', tpl);
            drop.dataset.accept = item.correct;

            // Drag and Drop (DnD) event listeners
            drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('hover'); });
            drop.addEventListener('dragleave', ()=> drop.classList.remove('hover'));
            drop.addEventListener('drop', e=>{
                e.preventDefault(); 
                drop.classList.remove('hover');
                const value = e.dataTransfer.getData('text/plain');
                placeAnswer(drop, value);
            });

            // Click-to-place functionality
            drop.addEventListener('click', ()=>{
                if(selectedTile){
                    placeAnswer(drop, selectedTile.dataset.value, selectedTile);
                }
            });

            return tpl;
        }

        // Places an answer tile into a drop zone
        function placeAnswer(drop, value, tileElem=null){
            // Prevent placing if already answered
            if(drop.classList.contains('correct') || drop.classList.contains('wrong')) return; 

            // Find the tile element if not provided (was dragged)
            if(!tileElem){
                tileElem = [...answersBank.children].find(t=> t.dataset.value === value && !t.classList.contains('lock')) || null;
            }

            // Set displayed value and check correctness
            drop.textContent = value;
            const isCorrect = value === drop.dataset.accept;
            drop.classList.add(isCorrect ? 'correct' : 'wrong');
            
            // Update UI for result
            const card = drop.closest('.card');
            const res = $('.result', card);
            const icon = isCorrect ? '‚úîÔ∏è' : '‚úñÔ∏è';
            res.innerHTML = `<span class="icon">${icon}</span> ${isCorrect ? '‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í!' : '‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í.'}`;
            res.className = 'result ' + (isCorrect ? 'ok' : 'bad');

            // Remove or lock the tile from the bank
            if(tileElem){
                tileElem.classList.add('lock');
                tileElem.classList.remove('selected');
                setTimeout(()=> {
                    if (tileElem.parentNode === answersBank) {
                       tileElem.remove();
                    }
                }, 150);
                if(selectedTile === tileElem) selectedTile = null;
            }

            // Update game state and UI
            state.answered++;
            if(isCorrect) state.correct++;
            updateUI();

            // Show a quick toast message
            toast.textContent = isCorrect ? '‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª!' : '‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª. ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.';
            toast.classList.add('show');
            setTimeout(()=>toast.classList.remove('show'), 1000);
        }

        // Updates the score, progress bar, and final message
        function updateUI(){
            scoreEl.textContent = `‡∂Ω‡∂ö‡∑î‡∂´‡∑î: ${state.correct} / ${DATA.length}`;
            const pct = Math.round((state.answered/DATA.length)*100);
            progressEl.style.width = pct + '%';

            if(state.answered === DATA.length){
                const msg = state.correct === DATA.length
                    ? 'üéâ ‡∑É‡∑î‡∂¥‡∂ª‡∑ä! ‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í. ‡∂î‡∂∂ ‡∂â‡∂≠‡∑è‡∂∏‡∂≠‡∑ä ‡∂±‡∑í‡∂∫‡∂∏‡∂∫‡∑í!'
                    : state.correct >= 3
                        ? `üëè ‡∑Ä‡∂©‡∑è‡∂≠‡∑ä ‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í! ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ${state.correct}/${DATA.length}. ‡∂≠‡∑Ä ‡∂ß‡∑í‡∂ö‡∂ö‡∑ä ‡∂¥‡∑î‡∑Ñ‡∑î‡∂´‡∑î ‡∑Ä‡∑î‡∂±‡∑ú‡∂≠‡∑ä ‡∂â‡∂≠‡∑è‡∂∏‡∂≠‡∑ä ‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í.`
                        : `üí™ ‡∑Ñ‡∂ª‡∑í! ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ${state.correct}/${DATA.length}. ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂∏‡∑î.`;
                finalMsg.textContent = msg;
            }
        }

        // Renders the initial game state
        function render(){
            quiz.innerHTML = '';
            answersBank.innerHTML = '';
            state = {answered:0, correct:0};
            selectedTile = null;
            updateUI();
            finalMsg.textContent = '‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂Ö‡∂ú‡∂∫ ‡∂ú‡∑ô‡∂±‡∑ä‡∑Ä‡∑è ‡∂á‡∂Ø ‡∂ë‡∑Ä‡∂±‡∑ä‡∂±.';

            // Render cards in a shuffled order
            const order = shuffle(DATA);
            order.forEach(item=> quiz.appendChild(makeCard(item)));

            // Create and shuffle the answer tiles in the bank
            const answers = shuffle(DATA.map(d=> d.correct));
            answers.forEach(a=> answersBank.appendChild(makeTile(a)));

            // Allow clicking outside to deselect a tile
            document.addEventListener('click', (e)=>{
                if(!e.target.closest('.tile') && selectedTile){
                    selectedTile.classList.remove('selected');
                    selectedTile = null;
                }
            });
        }

        // Checks all answers and provides feedback for unanswered questions
        function checkAll(){
            $$('.card').forEach(card=>{
                const drop = $('.dropzone', card);
                if(!(drop.classList.contains('correct') || drop.classList.contains('wrong'))){
                    drop.classList.add('wrong');
                    $('.result', card).innerHTML = `<span class="icon">‚ö†Ô∏è</span> ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∑è‡∂ú‡∂±‡∑ä‡∂±.`;
                    $('.result', card).className = 'result bad';
                }
            });
            // Update UI after checking all
            updateUI();
        }

        // Announce text for screen readers (accessibility)
        function announce(text){
            const live = document.createElement('div');
            live.className = 'sr-only';
            live.setAttribute('aria-live','assertive');
            live.textContent = text;
            document.body.appendChild(live);
            setTimeout(()=>document.body.removeChild(live), 500);
        }

        // Attach event listeners to control buttons
        $('#btnReset').addEventListener('click', render);
        $('#btnCheck').addEventListener('click', checkAll);
        
        // Toggle the visibility of the answers sidebar
        sidebarToggle.addEventListener('click', ()=>{
            isBankVisible = !isBankVisible;
            answersSidebar.classList.toggle('hidden', !isBankVisible);
            announce(isBankVisible ? '‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂∫‡∑í.' : '‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂∂‡∑ê‡∂Ç‡∂ö‡∑î‡∑Ä ‡∑É‡∑ê‡∂ü‡∑Ä‡∑ì ‡∂á‡∂≠.');
        });

        // Initialize the game when the page loads
        window.onload = render;
    </script>
</body>
</html>
